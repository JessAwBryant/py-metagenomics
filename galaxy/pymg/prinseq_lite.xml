<tool id="prinseq_lite" name="PrinSeq-lite" version="0.20.3">
    <description> Use prinseq-lite on a FASTA or FASTQ file to inspect or pre-process it. </description>
    <command interpreter="perl">
    prinseq-lite.pl
    #if $input.format == "0"
    -fasta $input.input_query
    #else
    -fastq $input.input_query
    #end if

#if $output.type == "stats"
    #for $cmd in str($output.commands).split(",")
    $cmd
    #end for
    > $output1
#end if

    </command>
    <inputs>
      <conditional name="input">
       <param name="format" type="select" label="Sequence format">
        <option value="0">Fasta</option>
        <option value="1">Fastq</option>
       </param>
       <when value="0">
        <param name="input_query" type="data" format="fasta" label="Compare these sequences" help="If you don't see your file, try changing the format above"/> 
       </when>
       <when value="1">
        <param name="input_query" type="data" format="fastq,fastqsanger,fastqcssanger,fastqsolexa,fastqillumina" label="Compare these sequences" help="If you don't see your file, try changing the format above"/> 
       </when>
      </conditional>
      <conditional name="output">
        <param name="type" type="select" label="Output type">
            <option value="stats" selcted="true">Statistics (text)</option>
            <option value="seqs">Fasta or Fastq</option>
        </param>
        <when value="stats">
            <param name="commands" type="select" label="Statistics" multiple="true">
                <option value="-stats_info" selected="true">Counts (reads, bases)</option>
                <option value="-stats_len" selected="true">Read lengths (mean, min, max, med, ...)</option>
                <option value="-stats_dinuc">Dinucleotide frequencies</option>
                <option value="-stats_tag">Tag probablities</option>
                <option value="-stats_dup">Duplicates</option>
                <option value="-stats_ns">N's</option>
                <option value="-stats_assembly">Assembly</option>
            </param>
        </when>
        <when value="seqs">
            <param name="seqFormat" type="select" label="Output format" help="This mode is non-functional in Galaxy. Contact John to have any of PrinSeq's processing abilities enabled.">
                <option value="fasta">Fasta</option>
                <option value="fastq" selected="true">Fastq</option>
            </param>
        </when>
    </conditional>
    </inputs>
    <stdio>
      <exit_code range="1:"  level="fatal"   description="Bad exit code" />
      <regex match="destination: Broken pipe" description="trivial warning" level="warning" source="error"/>
    </stdio>
    <outputs>
      <data name="output1" format="txt"/>
	  <change_format>
            <when input="output.seqFormat" value="fastq" format="fastq" />
            <when input="output.seqFormat" value="fasta" format="fasta" />
          </change_format>
    </outputs>
    <help>
    
.. class:: warningmark

**Note**. Database searches may take substantial amount of time. For large input datasets it is advisable to allow overnight processing.  

-----

**What it does**

The statistics are:
-stats_info
Outputs basic information such as number of reads (reads) and
total bases (bases).

-stats_len
Outputs minimum (min), maximum (max), range (range), mean
(mean), standard deviation (stddev), mode (mode) and mode value
(modeval), and median (median) for read length.

-stats_dinuc
Outputs the dinucleotide odds ratio for AA/TT (aatt), AC/GT
(acgt), AG/CT (agct), AT (at), CA/TG (catg), CC/GG (ccgg), CG
(cg), GA/TC (gatc), GC (gc) and TA (ta).

-stats_tag
Outputs the probability of a tag sequence at the 5'-end (prob5)
and 3'-end (prob3) in percentage (0..100). Provides the number
of predefined MIDs (midnum) and the MID sequences (midseq,
separated by comma, only provided if midnum > 0) that occur in
more than 34/100 (approx. 3%) of the reads.

-stats_dupl
Outputs the number of exact duplicates (exact), 5' duplicates
(5), 3' duplicates (3), exact duplicates with reverse
complements (exactrevcom) and 5'/3' duplicates with reverse
complements (revcomp), and total number of duplicates (total).
The maximum number of duplicates is given under the value name
with an additional "maxd" (e.g. exactmaxd or 5maxd).

-stats_ns
Outputs the number of reads with ambiguous base N (seqswithn),
the maximum number of Ns per read (maxn) and the maximum
percentage of Ns per read (maxp). The maxn and maxp value are
not necessary from the same sequence.

-stats_assembly
Outputs the N50, N90, etc contig sizes. The Nxx contig size is a
weighted median that is defined as the length of the smallest
contig C in the sorted list of all contigs where the cumulative
length from the largest contig to contig C is at least xx% of
the total length (sum of contig lengths).

    </help>
</tool>
