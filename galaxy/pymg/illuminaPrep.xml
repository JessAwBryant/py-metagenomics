<tool id="illumina_prep" name="illuminaPrep" version="0.1.0">
    <description> Trim and join paired Illumina fastq files </description>
    <stdio>
    	<exit_code range="1:"   level="fatal"   description="ERROR"/>
    </stdio>
    <command>
      illuminaPrep.py
	-v
	-f $read1
	-r $read2
	-o $output1
	-e $output2
	$outFormat
	-g $fakeJoinGap
	-p $primerFile
	-t $pandaseqCutoff
	#if $trim.dotrim=="trim" #-Q $trim.endQuality -P $trim.polyFrac -m $trim.minLength
	#else #--noTrim
	#end if
    	2> $output3
    </command>
    <inputs>
        <param format="fastq, fastqillumina, fastqsanger, fastqsolexa" name="read1" type="data" label="Read 1 Fastq" />
        <param format="fastq, fastqillumina, fastqsanger, fastqsolexa" name="read2" type="data" label="Read 2 Fastq" />
        <param format="fasta" name="primerFile" type="data" label="Primer file for trimming" />
        <param name="outFormat" type="select" label="Output format">
            <option value="-F" selected="True">Fastq</option>
            <option value="-a">Fasta</option>
        </param>
	<param name="fakeJoinGap" type="integer" value="6" min="-1" label="Link unjoined reads with this many N's. Use -1 to leave unjoined." />
	<conditional name="trim">
          <param name="dotrim" type="select" label="Skip all trimming">
            <option value="trim" selected="True">Perform post join trimming</option>
            <option value="notrim">Don't trim</option>
          </param>
          <when value="trim">
		<param name="endQuality" type="integer" value="5" min="0" label="Trim ends of reads with quality under this value."/>
		<param name="polyFrac" type="float" value=".9" min="0.0" max="1.0" label="Drop reads whene for than this fraction is a single base."/>
		<param name="minLength" type="integer" value="40" min="0" label="Minimum length of reads in output file" />
	  </when>
	</conditional>
	
	<param name="pandaseqCutoff" type="float" value=".32" min="0.0" max="1.0" label="PandaSeq cutoff. '.6' is the program's default. '.32' is good if you don't mind some suprious sequences"/>
    	
    </inputs>
    <outputs>
        <data name="output1" format="fastq">
	  <change_format>
            <when input="outFormat" value="-a" format="fasta" />
          </change_format>
        </data>
        <data name="output2" format="txt" label="illuminaPrep detailed log"/>
        <data name="output3" format="txt" label="illuminaPrep info log"/>
    </outputs>
    <help>
    
.. class:: warningmark

**What it does**

This tool runs **trimmomatic** and **pandaseq** using the illuminPrep script.

http://www.usadellab.org/cms/index.php?page=trimmomatic
https://github.com/neufeld/pandaseq
http://pyrodata.mit.edu/ddr2/scripts/show/87

-----

**Output format**

fastq or fasta

    </help>
</tool>
