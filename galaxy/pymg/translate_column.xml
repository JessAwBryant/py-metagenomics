<tool id="translate_column" name="Translate Column" version="0.1.01">
    <description>Add new column using map from existing column</description>
    <command interpreter='python'>
    translateColumn.py $input
    -o $outfile
    -c $source_column

    ## different ways to get map file
    #if $map.source=="Table"
    -m "${map.mapfile}"
    #end if
    #if $map.source=="Lastdb"
	#if $map.map_select=="taxmap"
	    -m "${map.mapdb.fields.taxmapfile}"
	#elsif $map.map_select=="komap"
	    -m "${map.mapdb.fields.kofile}"
	#else
	    -m "${map.mapdb.fields.descfile}"
	#end if
    #end if

    ## options
    #if str($fill.action).strip()=="Key" # -f KEY #else # -f $fill.fill_string #end if
    #if str($dest_column).strip()!="" # -C $dest_column #end if 
    #for $d in $delete # -D $d.delete_column #end for

</command>
<inputs>
    <param format="tabular" name="input" type="data" label="Add column to this table:"/>
    <param name="source_column" label="key column" type="data_column" data_ref="input" />
    <conditional name="map">
        <param name="source" type="select" label="Map file source">
            <option value="Table" selected="true">Table in current history</option>
            <option value="Lastdb">Built-in lastdb protein database</option>
        </param>
        <when value="Table">
            <param format="tabular" name="mapfile" type="data" label="Map to apply" help="Uses the first two columns as key and value for map"/>
        </when>
        <when value="Lastdb">
            <param name="mapdb" type="select" display="radio" label="against target database">
                <options from_data_table="lastdb" />
            </param>
	    <param name="map_select" type="select" display="radio" label="Which mapping file:" help="WARNING: some map files are empty for some DBs. EG: rRNA dbs won't have a KO map.">
		<option value="taxmap">Taxid map</option>
		<option value="komap">KEGG ko map</option>
		<option value="idmap" selected="True">Sequence descriptions</option>
	    </param>
        </when>
  </conditional>
    <param name="dest_column" type="integer" optional="true" label="Column number to create. " help="Leave blank to put just after key column. 0 for first column, -1 for last."/>
    <conditional name="fill">
        <param name="action" type="select" label="Fill missing values:">
            <option value="Skip" selected="True">Skip unmatched lines</option>
            <option value="Key">Fill with value in key column</option>
            <option value="String">Fill with specified string</option>
        </param>
        <when value="String">
            <param name="fill_string" type="text" label="Fill with this string:"/>
        </when>
    </conditional>
    <repeat name="delete" title="Delete Column">
        <param name="delete_column" label="Delete column from final table" type="integer" value="1"/>
    </repeat>
</inputs>
    <outputs>
        <data name="outfile" format="tabular"/>
    </outputs>
    <help>
        This script takes a tab delimited text table and creates a new column
        from an existing one using an external translation table.

    </help>
</tool>
